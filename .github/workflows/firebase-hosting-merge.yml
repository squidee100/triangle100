# This file was auto-generated by the Firebase CLI
# https://github.com/firebase/firebase-tools

name: Deploy to Firebase Hosting on merge
"on":
  push:
    branches:
      - main
jobs:
  build_and_deploy:
    name: Build and deploy
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Write version file
        uses: DamianReeves/write-file-action@v1.0
        with:
          path: src/lib/components/BuildNumber.svelte
          contents: |
            <span>v0.0.${{ github.run_number }} prod</span>
          write-mode: overwrite
      - run: npm ci && npm run build
      - uses: FirebaseExtended/action-hosting-deploy@v0
        with:
          repoToken: "${{ secrets.GITHUB_TOKEN }}"
          firebaseServiceAccount: "${{ secrets.FIREBASE_SERVICE_ACCOUNT_TRIANGLE100_C9280 }}"
          channelId: live
          projectId: triangle100-c9280
  release:
    name: Release build
    runs-on: ubuntu-latest
    steps:
      - name: Create GitHub release
        uses: actions/create-release@v1
        env:
          GITHUB_TOKEN: "${{ secrets.GITHUB_TOKEN }}"
          TAG_NAME: "v0.0.${{ github.run_number }} prod"
          RELEASE_NAME: "Build v0.0.${{ github.run_number }} prod"
        with:
          tag_name: ${{ env.TAG_NAME }}
          release_name: ${{ env.RELEASE_NAME }}